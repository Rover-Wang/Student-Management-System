{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h3>è¯¾ç¨‹ç®¡ç†</h3>
  <a href="{{ url_for('admin.add_course') }}" class="btn btn-primary mb-3">æ·»åŠ è¯¾ç¨‹</a>
  
  <table class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>è¯¾ç¨‹åç§°</th>
        <th>å­¦åˆ†</th>
        <th>æˆè¯¾æ•™å¸ˆ</th>
        <th>é€‰è¯¾äººæ•°</th>
        <th>åˆ›å»ºæ—¶é—´</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for course in courses %}
      <tr>
        <td>{{ course.id }}</td>
        <td>{{ course.name }}</td>
        <td>{{ course.credit }}</td>
        <td>{{ course.teacher_name if course.teacher_name else 'æœªåˆ†é…' }}</td>
        <!-- ğŸ”¥ å”¯ä¸€æ­£ç¡®å†™æ³•ï¼šç”¨æå‰è®¡ç®—çš„ student_countï¼Œæ— ä»»ä½•æ–¹æ³•è°ƒç”¨ -->
        <td><span class="badge bg-info">{{ course.student_count }} äºº</span></td>
        <td>{{ course.create_time.strftime('%Y-%m-%d %H:%M') if course.create_time else '-' }}</td>
        <td>
          <a href="{{ url_for('admin.course_detail', course_id=course.id) }}" class="btn btn-sm btn-info">è¯¦æƒ…</a>
          <a href="{{ url_for('admin.edit_course', course_id=course.id) }}" class="btn btn-sm btn-warning">ç¼–è¾‘</a>
          <button class="btn btn-sm btn-danger delete-btn" data-id="{{ course.id }}" data-name="{{ course.name }}">åˆ é™¤</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
$('.delete-btn').click(function() {
  const courseId = $(this).data('id');
  const courseName = $(this).data('name');
  if (confirm(`ç¡®è®¤åˆ é™¤è¯¾ç¨‹ã€${courseName}ã€‘å—ï¼Ÿ`)) {
    $.post(`/course/delete/${courseId}`, function(res) {
      if (res.code === 200) {
        alert(res.msg);
        window.location.reload();
      } else {
        alert(res.msg);
      }
    }).fail(function() {
      alert('åˆ é™¤è¯·æ±‚å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
    });
  }
});
</script>
{% endblock %}